erDiagram
    %% Media Management Tables
    MEDIA_TYPES {
        INT id PK
        VARCHAR name "image, video, audio, document"
        TEXT description
    }

    FILE_FORMATS {
        INT id PK
        VARCHAR extension "jpg, tiff, mp4, wav"
        VARCHAR mime_type "image/jpeg, video/mp4"
        INT media_type_id FK
        INT priority "processing hint"
        TEXT description
    }

    EXTENSION_ALIASES {
        VARCHAR alias "tif, JPG, jpeg"
        VARCHAR canonical FK "references file_formats.extension"
    }

    MEDIA {
        INT id PK
        VARCHAR storage_root "mount point e.g. /volume1/photos"
        VARCHAR directory "path from root e.g. 2024/January"
        VARCHAR filename "filename e.g. IMG_001.CR2"
        TEXT file_path "DEPRECATED - legacy column"
        CHAR file_hash "SHA-256, unique"
        BIGINT file_size
        VARCHAR file_ext "file extension"
        INT media_type_id FK
        DATETIME created "filesystem timestamp"
        BOOLEAN is_original "true if original"
        INT origin_id FK "provenance chain"
        JSON metadata "EXIF, dimensions, codec, etc"
        DATETIME created_at "when discovered"
        DATETIME updated_at "last metadata update"
        NUMERIC gps_latitude "GPS coordinates"
        NUMERIC gps_longitude "GPS coordinates"
        NUMERIC gps_altitude "altitude in meters"
        VARCHAR camera_make "camera manufacturer"
        VARCHAR camera_model "camera model"
        VARCHAR lens_model "lens model"
        INT width "image width pixels"
        INT height "image height pixels"
        INT rating "0-5 stars"
    }

    %% Classification System Tables
    CLASSIFICATION_SYSTEMS {
        INT id PK
        VARCHAR name "WFO, Geographic, Custom"
        TEXT description
        TEXT source_url
        VARCHAR classification_type "biological, geographic, subject, custom"
    }

    CLASSIFICATION_VERSIONS {
        INT id PK
        INT system_id FK
        VARCHAR version_string "2024-06, v1.2.3"
        DATETIME downloaded_at
        VARCHAR file_name
        BIGINT file_size
        CHAR checksum "SHA-256"
        BOOLEAN is_current "one per system"
        TEXT notes
    }

    CLASSIFICATION_NODES {
        BIGINT id PK
        INT version_id FK
        VARCHAR external_id "WFO ID, GBIF key"
        BIGINT parent_id FK
        VARCHAR name "primary identifier"
        VARCHAR rank "level in hierarchy"
        VARCHAR status "accepted, synonym, deprecated"
        VARCHAR authorship "authority attribution"
        JSON metadata "system-specific data"
    }

    %% Future: Media-Classification Linking
    MEDIA_CLASSIFICATION_LINKS {
        BIGINT id PK
        BIGINT media_id FK
        BIGINT classification_node_id FK
        VARCHAR assigned_by "system, user, ai"
        DECIMAL confidence "0.00 to 1.00"
        VARCHAR method "manual, ai_vision, geolocation"
        TIMESTAMP assigned_at
        TIMESTAMP verified_at
        VARCHAR verified_by
        VARCHAR status "pending, confirmed, disputed, rejected"
        TEXT notes
    }

    %% Relationships
    MEDIA_TYPES ||--o{ FILE_FORMATS : "categorizes"
    FILE_FORMATS ||--o{ EXTENSION_ALIASES : "normalizes"
    FILE_FORMATS ||--o{ MEDIA : "format_id → id"
    MEDIA_TYPES ||--o{ MEDIA : "media_type_id → id"
    MEDIA ||--o{ MEDIA : "origin_id → id (provenance)"

    CLASSIFICATION_SYSTEMS ||--o{ CLASSIFICATION_VERSIONS : "has versions"
    CLASSIFICATION_VERSIONS ||--o{ CLASSIFICATION_NODES : "contains nodes"
    CLASSIFICATION_NODES ||--o{ CLASSIFICATION_NODES : "parent_id → id (hierarchy)"

    MEDIA ||--o{ MEDIA_CLASSIFICATION_LINKS : "can be classified"
    CLASSIFICATION_NODES ||--o{ MEDIA_CLASSIFICATION_LINKS : "classifies media"
